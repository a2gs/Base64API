All this code was based from Jan-Henrik Haukeland <hauk@tildeslash.com> (v 1.2 2006/06/21 00:18:21) code.
